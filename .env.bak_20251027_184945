# =============================================================================
# BACKTEST CONFIGURATION - Phase 6 Rank 1 (Best Sharpe + PnL)
# =============================================================================
# Date Range: 2024-01-01 to 2025-10-31 (22 months)
# Primary Timeframe: 15-minute bars
# Expected Performance (in-sample reference from Phase 6):
#   - Sharpe Ratio: 0.481
#   - Total PnL: $10,859.43 (10.86% return on $100k)
#   - Win Rate: 62.1%
#   - Trade Count: 58 trades
#   - Rejected Signals: 272 (filter effectiveness)
# =============================================================================

# -----------------------------------------------------------------------------
# REQUIRED: Symbol and Date Range
# -----------------------------------------------------------------------------
BACKTEST_SYMBOL=EUR/USD
BACKTEST_VENUE=IDEALPRO
BACKTEST_START_DATE=2024-01-01
BACKTEST_END_DATE=2025-10-31

# -----------------------------------------------------------------------------
# PRIMARY TIMEFRAME: 15-Minute Bars (MA Crossover Signals)
# -----------------------------------------------------------------------------
BACKTEST_BAR_SPEC=15-MINUTE-MID-EXTERNAL

# -----------------------------------------------------------------------------
# MOVING AVERAGE PARAMETERS (Phase 6 Optimized)
# -----------------------------------------------------------------------------
# Fast MA: 42 periods Ã— 15 min = 10.5 hours
# Slow MA: 270 periods Ã— 15 min = 67.5 hours (~3 trading days)
BACKTEST_FAST_PERIOD=42
BACKTEST_SLOW_PERIOD=270

# -----------------------------------------------------------------------------
# POSITION SIZING
# -----------------------------------------------------------------------------
BACKTEST_TRADE_SIZE=100000
BACKTEST_STARTING_CAPITAL=100000.0

# -----------------------------------------------------------------------------
# RISK MANAGEMENT (Phase 6 Optimized)
# -----------------------------------------------------------------------------
# Stop Loss: 35 pips = $350 risk per standard lot
# Take Profit: 50 pips = $500 profit per standard lot
# Risk/Reward Ratio: 1.43:1
BACKTEST_STOP_LOSS_PIPS=35
BACKTEST_TAKE_PROFIT_PIPS=50

# Trailing Stop Configuration
# Activates when position profit reaches 22 pips ($220)
# Trails 12 pips ($120) behind current price
BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=22
BACKTEST_TRAILING_STOP_DISTANCE_PIPS=12

# -----------------------------------------------------------------------------
# SIGNAL FILTERS (Phase 6 Optimized)
# -----------------------------------------------------------------------------
# Crossover Threshold: Minimum 0.35 pip separation for valid crossover
# Reduces false signals during choppy markets
STRATEGY_CROSSOVER_THRESHOLD_PIPS=0.35

# Pre-Crossover Separation (Disabled in Phase 6)
STRATEGY_PRE_CROSSOVER_SEPARATION_PIPS=0.0
STRATEGY_PRE_CROSSOVER_LOOKBACK_BARS=1

# -----------------------------------------------------------------------------
# DMI TREND FILTER (Multi-Timeframe: 2-Minute Bars)
# -----------------------------------------------------------------------------
# DMI validates trend direction alignment before entry
# Bullish crossover requires +DI > -DI (uptrend)
# Bearish crossover requires -DI > +DI (downtrend)
STRATEGY_DMI_ENABLED=true
STRATEGY_DMI_PERIOD=10
STRATEGY_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL

# -----------------------------------------------------------------------------
# STOCHASTIC MOMENTUM FILTER (15-Minute Bars - Same as Primary)
# -----------------------------------------------------------------------------
# Stochastic validates momentum alignment and prevents buying tops/selling bottoms
# Bullish entry: %K > %D AND %K > 27 AND %D > 27 (upward momentum)
# Bearish entry: %K < %D AND %K < 63 AND %D < 63 (downward momentum)
STRATEGY_STOCH_ENABLED=true
STRATEGY_STOCH_PERIOD_K=19
STRATEGY_STOCH_PERIOD_D=3
STRATEGY_STOCH_BULLISH_THRESHOLD=27
STRATEGY_STOCH_BEARISH_THRESHOLD=63
STRATEGY_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
STRATEGY_STOCH_MAX_BARS_SINCE_CROSSING=9

# -----------------------------------------------------------------------------
# POSITION MANAGEMENT
# -----------------------------------------------------------------------------
ENFORCE_POSITION_LIMIT=true
ALLOW_POSITION_REVERSAL=false

# -----------------------------------------------------------------------------
# ORDER EXECUTION (Optional - Uncomment to Enable)
# -----------------------------------------------------------------------------
# USE_LIMIT_ORDERS=false
# LIMIT_ORDER_TIMEOUT_BARS=5
# =============================================================================
# TIME FILTER CONFIGURATION - Restrict Trading to Specific Hours
# =============================================================================
# Time filtering restricts trading to specific hours of the day, helping avoid
# low-liquidity periods, unprofitable hours, or specific market sessions. It
# supports both continuous trading windows (start/end hours) and excluded hour
# lists for granular control.

BACKTEST_TIME_FILTER_ENABLED=enabled
# Enable/disable time-based trade filtering (default: false). When enabled,
# trades are only executed during configured hours.

BACKTEST_TRADING_HOURS_START=0
# Trading window start hour in 24-hour format (0-23). Trades allowed from this
# hour (inclusive) to end hour. Must be less than TRADING_HOURS_END (overnight
# windows not supported).

BACKTEST_TRADING_HOURS_END=23
# Trading window end hour in 24-hour format (0-23). Trades allowed until this
# hour (inclusive). Example: start=8, end=16 allows trading from 8:00 AM to
# 4:59 PM.

BACKTEST_TRADING_HOURS_TIMEZONE=America/New_York
# IANA timezone string for hour interpretation (e.g., America/New_York,
# Europe/London, Asia/Tokyo, UTC). All bar timestamps are converted to this
# timezone before checking trading hours. See:
# https://en.wikipedia.org/wiki/List_of_tz_database_time_zones

BACKTEST_EXCLUDED_HOURS= 0,1,2,3,13,22 
# Comma-separated list of hours (0-23) to exclude from trading, checked BEFORE
# start/end range validation. Useful for excluding specific unprofitable hours
# while maintaining a broader trading window. Works independently or alongside
# start/end parameters. Leave empty to disable.
# Example: "0,1,2,3,13,22" excludes midnight-3am and 1pm and 10pm.

# Usage Examples:
#
# Example 1: US Stock Market Hours (9 AM - 4 PM Eastern)
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_TRADING_HOURS_START=9
# BACKTEST_TRADING_HOURS_END=16
# BACKTEST_TRADING_HOURS_TIMEZONE=America/New_York
# BACKTEST_EXCLUDED_HOURS=
#
# Example 2: Exclude Unprofitable Hours (based on trade timing analysis)
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_TRADING_HOURS_START=4
# BACKTEST_TRADING_HOURS_END=21
# BACKTEST_TRADING_HOURS_TIMEZONE=UTC
# BACKTEST_EXCLUDED_HOURS=13  # Exclude 1 PM hour if analysis shows poor performance
#
# Example 3: Exclude Overnight and Lunch Hours
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_TRADING_HOURS_START=0
# BACKTEST_TRADING_HOURS_END=23
# BACKTEST_TRADING_HOURS_TIMEZONE=UTC
# BACKTEST_EXCLUDED_HOURS=0,1,2,3,22,23,12,13 # No overnight (midnight-3am, 10pm-11pm) or lunch (noon-1pm)
#
# Example 4: London Forex Session Only (8 AM - 5 PM GMT)
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_TRADING_HOURS_START=8
# BACKTEST_TRADING_HOURS_END=17
# BACKTEST_TRADING_HOURS_TIMEZONE=Europe/London
# BACKTEST_EXCLUDED_HOURS=
#
# Example 5: Disable Time Filtering (Trade 24/7)
# BACKTEST_TIME_FILTER_ENABLED=false
# # Other time filter parameters ignored when disabled

# Parameter Interactions:
# - excluded_hours is checked FIRST, then start/end range
# - excluded_hours works independently: can exclude specific hours even with start=0, end=23
# - Rejection reasons logged separately: 'time_filter_excluded_hour' vs 'time_filter_outside_hours'
# - Both filters can be used together for maximum control
# - Validation: start < end (overnight windows not supported in current implementation)
# - Validation: excluded_hours cannot block ALL hours in trading window
#
# Performance Impact:
# - Rejected signals are logged to rejected_signals.csv with reason
# - Use tools/analyze_trade_timing.py to identify unprofitable hours from backtest results
# - Time filtering reduces trade count but may improve Sharpe ratio and win rate

# ============================================================================

# -----------------------------------------------------------------------------
# IBKR Connection Configuration (Paper Trading)
# -----------------------------------------------------------------------------

IB_HOST=127.0.0.1  # Localhost address for IBKR TWS connection
IB_PORT=7497  # Standard paper trading port for TWS (7497 for paper, 7496 for live)
IB_CLIENT_ID=1  # Unique client identifier for this connection
IB_ACCOUNT_ID=DU1558484  # The user's paper trading account ID
IB_MARKET_DATA_TYPE=REALTIME 
