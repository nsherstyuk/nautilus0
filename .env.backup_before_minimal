# NautilusTrader Environment Variables Example
# Copy this file to .env and modify the values as needed


# Data Ingestion Configuration
DATA_SYMBOLS=EUR/USD                         #  ADD THIS LINE!
DATA_START_DATE=2024-01-01                  #  ADD THIS LINE!
DATA_END_DATE=2025-10-30  

# =============================================================================
# BACKTESTING PARAMETERS
# =============================================================================
# # Interactive Brokers (IBKR) Gateway/TWS connection
# Paper trading typically uses port 7497 for TWS or 4002 for IB Gateway
IB_HOST=127.0.0.1
IB_PORT=7497
IB_CLIENT_ID=17
IB_ACCOUNT_ID=DU1558484
IB_MARKET_DATA_TYPE=REALTIME
IB_MAX_CONNECTION_ATTEMPTS=5

# Required Variables
BACKTEST_SYMBOL=EUR/USD
BACKTEST_START_DATE=2024-01-01
BACKTEST_END_DATE=2025-10-30






# Optional Variables with Defaults
BACKTEST_VENUE=IDEALPRO

BACKTEST_TRADE_SIZE=100000
BACKTEST_STARTING_CAPITAL=100000.0
CATALOG_PATH=data/historical
OUTPUT_DIR=logs/backtest_results
ENFORCE_POSITION_LIMIT=true
ALLOW_POSITION_REVERSAL=false

BACKTEST_BAR_SPEC=15-MINUTE-MID-EXTERNAL
BACKTEST_FAST_PERIOD=40   #42
BACKTEST_SLOW_PERIOD=260  #260



# Fixed stops (from $14,845 winning run)
BACKTEST_STOP_LOSS_PIPS=25
BACKTEST_TAKE_PROFIT_PIPS=80
BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=25
BACKTEST_TRAILING_STOP_DISTANCE_PIPS=20

# Market Regime Detection (from $14,845 winning run)
STRATEGY_REGIME_DETECTION_ENABLED=true
STRATEGY_REGIME_ADX_TRENDING_THRESHOLD=25.0
STRATEGY_REGIME_ADX_RANGING_THRESHOLD=20.0
STRATEGY_REGIME_TP_MULTIPLIER_TRENDING=1.5
STRATEGY_REGIME_TP_MULTIPLIER_RANGING=0.8
STRATEGY_REGIME_SL_MULTIPLIER_TRENDING=1.0
STRATEGY_REGIME_SL_MULTIPLIER_RANGING=1.0
STRATEGY_REGIME_TRAILING_ACTIVATION_MULTIPLIER_TRENDING=0.75
STRATEGY_REGIME_TRAILING_ACTIVATION_MULTIPLIER_RANGING=1.25
STRATEGY_REGIME_TRAILING_DISTANCE_MULTIPLIER_TRENDING=0.67
STRATEGY_REGIME_TRAILING_DISTANCE_MULTIPLIER_RANGING=1.33

STRATEGY_DMI_BAR_SPEC=5-MINUTE-MID-EXTERNAL
STRATEGY_DMI_PERIOD=14
STRATEGY_DMI_MINIMUM_DIFFERENCE=0.0
STRATEGY_CROSSOVER_THRESHOLD_PIPS=0.15
STRATEGY_DMI_ENABLED=false
STRATEGY_DMI_BAR_SPEC=5-MINUTE-MID-EXTERNAL
STRATEGY_DMI_PERIOD=14
STRATEGY_DMI_MINIMUM_DIFFERENCE=0.0
#STRATEGY_STOCH_ENABLED=false
#STRATEGY_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
#STRATEGY_STOCH_PERIOD_K=17
#STRATEGY_STOCH_PERIOD_D=3
#STRATEGY_STOCH_BULLISH_THRESHOLD=25
#STRATEGY_STOCH_BEARISH_THRESHOLD=75   #63
#STRATEGY_STOCH_MAX_BARS_SINCE_CROSSING=12
# ============================================================================
# ============================================================================
# STRATEGY FILTER CONFIGURATION - TREND FILTER (Price vs EMA)
# ============================================================================
# Trend filter checks if bar closing price is above/below a single EMA.
# Only allows signals when price aligns with the trend direction.
#
# Logic:
# - BUY signals: Only allowed when bar close > EMA(period) + threshold
# - SELL signals: Only allowed when bar close < EMA(period) - threshold
#
STRATEGY_TREND_FILTER_ENABLED=false                 # Enable/disable trend filter
STRATEGY_TREND_BAR_SPEC=5-MINUTE-MID-EXTERNAL         # Bar timeframe for trend filter (default: 1-minute)
STRATEGY_TREND_EMA_PERIOD=200                         # EMA period for trend (default: 150)
STRATEGY_TREND_EMA_THRESHOLD_PIPS=2     #0.8                 # Minimum distance in pips above/below EMA (default: 0.0)
#
# Threshold Examples:
# - 0.0: No threshold - just requires price > EMA for BUY, price < EMA for SELL
# - 1.0: Requires price to be at least 1 pip above EMA for BUY, 1 pip below for SELL
# - 5.0: Requires price to be at least 5 pips above EMA for BUY, 5 pips below for SELL
# - 10.0: More conservative - requires 10 pips distance from EMA

# ============================================================================
# STRATEGY FILTER CONFIGURATION - ATR (Average True Range)
# ============================================================================
# ATR filter provides trend strength confirmation using volatility as a proxy.
# Only allows signals when market volatility exceeds minimum threshold.
#
# Benefits:
# - Avoids trading in low-volatility, ranging markets
# - Confirms sufficient market movement for trend development
# - Higher ATR often indicates stronger trends
#
# Configuration Parameters:
STRATEGY_ATR_ENABLED=false                  # Enable/disable ATR filter (default: false)
STRATEGY_ATR_PERIOD=14                      # ATR calculation period (default: 14)
STRATEGY_ATR_MIN_STRENGTH=0.0004             # Minimum ATR value required (default: 0.001)
#
# Important Notes:
# - ATR needs 14 bars to initialize; signals before init skip check
# - ATR values depend on instrument price level (higher for indices, lower for FX)
# - For EUR/USD (1.05-1.15 range): 0.001 = 10 pips, 0.002 = 20 pips average range
# - For higher-priced assets: scale ATR threshold accordingly
# - Lower threshold = more signals, higher threshold = fewer but stronger trends
# - Set STRATEGY_ATR_ENABLED=false to disable






# =============================================================================
# LIVE TRADING PARAMETERS
# =============================================================================

# Interactive Brokers Configuration
IBKR_HOST=127.0.0.1
IBKR_PORT=7497
IBKR_CLIENT_ID=14

# Core Trading Parameters (Updated with optimized values from grid search rank 1)
LIVE_SYMBOL=EUR/USD
LIVE_VENUE=IDEALPRO
LIVE_BAR_SPEC=15-MINUTE-MID-EXTERNAL
LIVE_FAST_PERIOD=46
LIVE_SLOW_PERIOD=297
LIVE_TRADE_SIZE=100000
LIVE_ENFORCE_POSITION_LIMIT=true
LIVE_ALLOW_POSITION_REVERSAL=false
LIVE_LOG_DIR=logs/live
LIVE_TRADER_ID=LIVE-TRADER-001

# Risk Management - Stop Loss and Take Profit
LIVE_STOP_LOSS_PIPS=40
LIVE_TAKE_PROFIT_PIPS=57

# Trailing Stop Configuration
LIVE_TRAILING_STOP_ACTIVATION_PIPS=19
LIVE_TRAILING_STOP_DISTANCE_PIPS=10

# Crossover Threshold Filter
LIVE_CROSSOVER_THRESHOLD_PIPS=0.35

# ============================================================================
# LIVE TRADING FILTER CONFIGURATION - DMI (Directional Movement Index)
# ============================================================================
# DMI filter provides trend confirmation for MA crossover signals using multi-timeframe bars.
# The filter checks if DMI +DI and -DI lines align with the crossover direction:
#   - Bullish crossover requires: +DI > -DI (bullish trend)
#   - Bearish crossover requires: -DI > +DI (bearish trend)
#
# Additionally, if dmi_minimum_difference > 0, the filter enforces that:
#   - The difference between +DI and -DI must be at least the threshold value
#   - This filters out weak/noisy trends where DI values are too close together
#   - Example: With threshold=5.0, +DI=30 vs -DI=28 (difference=2) would be rejected
#   - Example: With threshold=5.0, +DI=35 vs -DI=25 (difference=10) would pass
#
LIVE_DMI_ENABLED=true                          # Enable/disable DMI filter (default: true)
LIVE_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL       # Bar timeframe for DMI (default: 2-minute)
LIVE_DMI_PERIOD=14                             # DMI smoothing period (default: 14)
LIVE_DMI_MINIMUM_DIFFERENCE=0.0                # Minimum DI difference for valid trend (default: 0.0 = disabled, backward compatible)
#
# Notes:
# - DMI needs period bars to initialize; signals before init skip the DMI check
# - For FX, prefer MID price side to match catalog data
# - Use -EXTERNAL for historical catalog bars
# - minimum_difference: 0.0 = disabled (current behavior), > 0.0 = filter weak trends
#   Recommended values:
#     - 0.0: Disabled (allows any +DI > -DI, even tiny differences)
#     - 2.0: Light filtering (removes very weak trends)
#     - 5.0: Moderate filtering (filters noise, good balance) [RECOMMENDED]
#     - 10.0: Aggressive filtering (only strong trends)
# - The difference is calculated as: |+DI - -DI| for the favorable direction
# Stochastic Momentum Filter (DISABLED per optimization results)
LIVE_STOCH_ENABLED=false
LIVE_STOCH_PERIOD_K=19
LIVE_STOCH_PERIOD_D=3
LIVE_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
LIVE_STOCH_BULLISH_THRESHOLD=27
LIVE_STOCH_BEARISH_THRESHOLD=63
LIVE_STOCH_MAX_BARS_SINCE_CROSSING=9

# ATR Volatility Filter (DISABLED per optimization results)
LIVE_ATR_ENABLED=false
LIVE_ATR_PERIOD=14
LIVE_ATR_MIN_THRESHOLD=0.0003
LIVE_ATR_MAX_THRESHOLD=0.003

# ADX Trend Strength Filter (DISABLED per optimization results)
LIVE_ADX_ENABLED=false
LIVE_ADX_PERIOD=14
LIVE_ADX_MIN_THRESHOLD=20.0

# Time-of-Day Filter (DISABLED per optimization results)
LIVE_MARKET_TIMEZONE=America/New_York

# Circuit Breaker (ENABLED for safety)
LIVE_CIRCUIT_BREAKER_ENABLED=true
LIVE_MAX_CONSECUTIVE_LOSSES=3
LIVE_COOLDOWN_BARS=10

# Limit Order Configuration
LIVE_USE_LIMIT_ORDERS=true
LIVE_LIMIT_ORDER_TIMEOUT_BARS=1

# =============================================================================
# LIVE TRADING PARAMETER DOCUMENTATION
# =============================================================================
# These parameters are based on grid search optimization results (Rank 1):
# - Objective Value: ,250.50 (total PnL)
# - Optimization Date Range: 2024-01-01 to 2024-03-31
# - Strategy: Moving Average Crossover with filters DISABLED
# - Risk/Reward: 2:1 (25 pips SL / 50 pips TP)
#
# Key Findings from Optimization:
# 1. Faster MA periods (10/50) outperformed slower periods (20/100)
# 2. No crossover threshold (0.0) performed best
# 3. All filters (DMI, Stochastic, ATR, ADX) were disabled for best results
# 4. Standard risk management (25/50 pips) with trailing stops
#
# IMPORTANT NOTES FOR LIVE TRADING:
# - Start with paper trading account (IB_ACCOUNT_ID should start with DU)
# - Monitor first 24 hours continuously
# - Filters are DISABLED - strategy relies purely on MA crossover
# - Circuit breaker is ENABLED as safety measure (not in optimization)
# - Expected trade frequency: Higher than filtered strategy
# - Expected rejection rate: Low (~0-10% vs 99% in baseline)
#
# VALIDATION STATUS:
# - In-sample performance: ,250.50 (optimization period)
# - Out-of-sample validation: [PENDING - run before live deployment]
# - Walk-forward validation: [PENDING - recommended]
# - Parameter clustering: [REVIEW grid_search_results_top_10.json]
#
# DEPLOYMENT CHECKLIST:
# [ ] Verify TWS/Gateway is running on port 7497
# [ ] Confirm IB_ACCOUNT_ID is paper trading account (DU prefix)
# [ ] Run out-of-sample backtest with these parameters
# [ ] Review monitoring checklist (see LIVE_TRADING_MONITORING_CHECKLIST.md)
# [ ] Set up daily PnL alerts
# [ ] Define stop conditions (max daily loss, max drawdown)
# [ ] Prepare rollback plan (revert to baseline parameters)
# =============================================================================

# =============================================================================
# FOREX EXAMPLE CONFIGURATION
# =============================================================================

# Example for EUR/USD trading
# BACKTEST_SYMBOL=EURUSD
# BACKTEST_VENUE=IDEALPRO
# BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL
# BACKTEST_STOP_LOSS_PIPS=2     # Stop loss distance in pips (EUR/USD: 25 pips = 0.0025)
# BACKTEST_TAKE_PROFIT_PIPS=5   # Take profit distance in pips (EUR/USD: 50 pips = 0.0050)
# BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=3 # Activate trailing stop after this many pips of profit
# BACKTEST_TRAILING_STOP_DISTANCE_PIPS=1    # Trail stop loss by this many pips behind current price

# =============================================================================
# IBKR HISTORICAL DATA CHUNKING CONFIGURATION
# =============================================================================
# Automatic chunking prevents timeouts when requesting large date ranges.
# IBKR has documented limits (60 requests per 10 minutes) and practical
# timeout thresholds that vary by bar size:
#   - 1-minute bars: ~7 days per request
#   - 15-minute bars: ~60 days per request
#   - Daily bars: ~10 years per request
#
# Chunking splits large date ranges into smaller requests with pacing delays.

# Enable/disable automatic chunking (default: true)
# Set to false to use single requests (only for short date ranges)
IBKR_ENABLE_CHUNKING=true

# Delay between chunk requests in seconds (default: 10)
# Prevents IBKR pacing violations (max 60 requests per 10 minutes)
# Recommended: 10 seconds (safe for all bar sizes)
# Minimum: 1 second (risky, may trigger error 162)
IBKR_REQUEST_DELAY_SECONDS=10

# Overlap between chunks in minutes (default: 0)
# Adds redundancy at chunk boundaries to prevent gaps
# Set to 0 for no overlap (recommended for most use cases)
# Set to 1-5 minutes if you observe missing bars at chunk boundaries
IBKR_CHUNK_OVERLAP_MINUTES=0




STRATEGY_STOCH_ENABLED=false
STRATEGY_STOCH_PERIOD_K=19
STRATEGY_STOCH_PERIOD_D=3
STRATEGY_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
STRATEGY_STOCH_BULLISH_THRESHOLD= 30                   #27
STRATEGY_STOCH_BEARISH_THRESHOLD= 70                     #70
STRATEGY_STOCH_MAX_BARS_SINCE_CROSSING=9

# Time filter to exclude unprofitable hours (from $14,845 winning run)
BACKTEST_TIME_FILTER_ENABLED=true
BACKTEST_EXCLUDED_HOURS=0,1,8,10,11,12,13,18,19,23
BACKTEST_EXCLUDED_HOURS_MODE=weekday
BACKTEST_EXCLUDED_HOURS_MONDAY=0,1,3,4,5,8,10,11,12,13,18,19,23
BACKTEST_EXCLUDED_HOURS_TUESDAY=0,1,2,4,5,6,7,8,9,10,11,12,13,18,19,23
BACKTEST_EXCLUDED_HOURS_WEDNESDAY=0,1,8,9,10,11,12,13,14,15,16,17,18,19,23
BACKTEST_EXCLUDED_HOURS_THURSDAY=0,1,2,7,8,10,11,12,13,14,18,19,22,23
BACKTEST_EXCLUDED_HOURS_FRIDAY=0,1,2,3,4,5,8,9,10,11,12,13,14,15,16,17,18,19,23
BACKTEST_EXCLUDED_HOURS_SATURDAY=
BACKTEST_EXCLUDED_HOURS_SUNDAY=0,1,8,10,11,12,13,18,19,21,22,23

# ==============================================================================
# Live Trading Time Filter Configuration
# Based on backtest analysis - excludes unprofitable trading hours (UTC)
# ==============================================================================
LIVE_TIME_FILTER_ENABLED=true
LIVE_TRADING_HOURS_START=0
LIVE_TRADING_HOURS_END=23
LIVE_TRADING_HOURS_TIMEZONE=UTC
LIVE_EXCLUDED_HOURS=0,20,22                          #1,2,12,13,18,21,22,23
# Dormant Mode Environment Variables
# ===================================
# These variables control the dormant mode feature which switches to lower timeframe
# trading when EMA crossings are rare. All parameters default to disabled (False)
# for zero impact on existing configurations.
#
# To enable dormant mode, set BACKTEST_DORMANT_MODE_ENABLED=true (or LIVE_DORMANT_MODE_ENABLED=true for live trading)



# Live Trading Dormant Mode Configuration
LIVE_DORMANT_MODE_ENABLED=true
LIVE_DORMANT_THRESHOLD_HOURS=14.0
LIVE_DORMANT_BAR_SPEC=1-MINUTE-MID-EXTERNAL
LIVE_DORMANT_FAST_PERIOD=5
LIVE_DORMANT_SLOW_PERIOD=10
LIVE_DORMANT_STOP_LOSS_PIPS=20
LIVE_DORMANT_TAKE_PROFIT_PIPS=30
LIVE_DORMANT_TRAILING_ACTIVATION_PIPS=15
LIVE_DORMANT_TRAILING_DISTANCE_PIPS=8
LIVE_DORMANT_DMI_ENABLED=false
LIVE_DORMANT_STOCH_ENABLED=false

