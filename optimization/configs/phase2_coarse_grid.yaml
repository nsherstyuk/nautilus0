# ============================================
# Phase 2: Coarse Grid Search Configuration
# ============================================
# MA Period and Crossover Threshold Optimization
#
# This configuration tests 120 valid combinations (5×5×5 minus 5 invalid fast==slow cases) 
# to identify promising parameter regions for fast_period, slow_period, and crossover_threshold_pips
#
# Usage:
#   python optimization/grid_search.py --config optimization/configs/phase2_coarse_grid.yaml --objective sharpe_ratio --workers 8 --output optimization/results/phase2_coarse_grid_results.csv --verbose
#
# Resume Behavior:
#   By default, the optimizer will resume from checkpoint if available (--resume is default).
#   To force a fresh start, use --no-resume.
#
#   # Resume from checkpoint (default behavior)
#   python optimization/grid_search.py --config optimization/configs/phase2_coarse_grid.yaml --resume
#
#   # Start fresh (ignore existing checkpoint)
#   python optimization/grid_search.py --config optimization/configs/phase2_coarse_grid.yaml --no-resume
#   # Note: Use --no-resume after fixing systemic errors to ensure fresh start
#
#   Checkpoint file: optimization/checkpoints/phase2_coarse_grid_checkpoint.csv
#
# Expected Runtime:
#   - With 8 workers: ~2-3 hours (120 backtests × ~60s each ÷ 8 workers)
#   - Per backtest: ~60 seconds (7-month period)
#   - Total backtest time: 120 × 60s = 7,200s = 120 minutes
#   - Parallelized: 120 min ÷ 8 workers = ~15 minutes
#   - With overhead: ~2-3 hours total
#
# Phase Context:
#   This is the first optimization phase. Results will be used to create 
#   Phase 3 fine grid configuration.
#
# Success Criteria:
#   Top 10 results should show Sharpe ratio > baseline, clear winner region should emerge

# ============================================
# Optimization Settings
# ============================================
optimization:
  # Objective function to maximize
  # Using Sharpe ratio for risk-adjusted returns optimization
  objective: sharpe_ratio
  
  # Number of parallel workers
  # 8 workers provides good balance between speed and system stability
  workers: 8
  
  # Save checkpoint every N backtests
  # Allows resuming if interrupted
  checkpoint_interval: 10
  
  # Maximum time per backtest in seconds
  # 5 minutes should be sufficient for 7-month backtest period
  timeout_seconds: 300
  
  # Checkpoint file for resuming interrupted optimizations
  # Saves progress every checkpoint_interval backtests
  checkpoint_file: optimization/checkpoints/phase2_coarse_grid_checkpoint.csv

# ============================================
# Parameter Ranges for Coarse Grid Search
# ============================================
# Testing 3 core parameters with 5 values each (120 valid combinations after validation)
# All other parameters are fixed to baseline defaults (see fixed section below)
parameters:
  # Fast Moving Average Period
  # Testing range: 10 to 50 periods with 10-period spacing
  # Rationale: Captures short-term to medium-term trend responsiveness
  fast_period:
    values: [10, 20, 30, 40, 50]
  
  # Slow Moving Average Period
  # Testing range: 50 to 250 periods with 50-period spacing
  # Rationale: Captures medium-term to long-term trend direction
  # Note: Must be greater than fast_period (validated by grid_search.py)
  slow_period:
    values: [50, 100, 150, 200, 250]
  
  # Crossover Threshold (pips)
  # Testing range: 0.0 (disabled) to 2.0 (aggressive filtering)
  # Rationale: Balances signal quality vs quantity
  # 0.0 = No threshold (all crossovers accepted)
  # 0.5 = Minimal separation required
  # 1.0 = Moderate separation (baseline default is 0.7)
  # 1.5 = Strong separation required
  # 2.0 = Very strong separation (may miss valid signals)
  crossover_threshold_pips:
    values: [0.0, 0.5, 1.0, 1.5, 2.0]

# ============================================
# Fixed Parameters (Not Optimized in Phase 2)
# ============================================
# These parameters remain constant to isolate the impact of MA periods and crossover threshold
# Risk management and filter parameters will be optimized in subsequent phases
fixed:
  # ============================================
  # Risk Management Parameters (Fixed at Baseline Defaults)
  # ============================================
  # These will be optimized in Phase 4 after MA parameters are finalized
  
  # Stop Loss (pips)
  # Fixed at baseline default
  stop_loss_pips: 25
  
  # Take Profit (pips)
  # Fixed at baseline default (2:1 reward-to-risk ratio)
  take_profit_pips: 50
  
  # Trailing Stop Activation (pips)
  # Distance in profit before trailing stop activates
  trailing_stop_activation_pips: 20
  
  # Trailing Stop Distance (pips)
  # Distance to trail behind current price
  trailing_stop_distance_pips: 15
  
  # ============================================
  # Crossover Filter Parameters (Fixed at Baseline Defaults)
  # ============================================
  
  # Pre-Crossover Separation (pips)
  # Disabled for Phase 2 (set to 0.0)
  pre_crossover_separation_pips: 0.0
  
  # Pre-Crossover Lookback (bars)
  # Number of bars to check for separation
  pre_crossover_lookback_bars: 1
  
  # ============================================
  # DMI Filter Parameters (Fixed at Baseline Defaults)
  # ============================================
  # These will be optimized in Phase 5 after risk management is finalized
  
  # DMI Filter Enabled
  # Keep enabled to maintain baseline filter behavior
  dmi_enabled: true
  
  # DMI Period
  # Standard 14-period DMI
  dmi_period: 14
  
  # DMI Bar Specification
  # Using 2-minute bars for DMI calculation
  dmi_bar_spec: "2-MINUTE-MID-EXTERNAL"
  
  # ============================================
  # Stochastic Filter Parameters (Fixed at Baseline Defaults)
  # ============================================
  # These will be optimized in Phase 5 after risk management is finalized
  
  # Stochastic Filter Enabled
  # Keep enabled to maintain baseline filter behavior
  stoch_enabled: true
  
  # Stochastic %K Period
  # Standard 14-period stochastic
  stoch_period_k: 14
  
  # Stochastic %D Period (smoothing)
  # Standard 3-period smoothing
  stoch_period_d: 3
  
  # Stochastic Bullish Threshold
  # Enter long when stochastic crosses above this level
  stoch_bullish_threshold: 30
  
  # Stochastic Bearish Threshold
  # Enter short when stochastic crosses below this level
  stoch_bearish_threshold: 70
  
  # Stochastic Max Bars Since Crossing
  # Maximum age of stochastic crossing to be considered valid
  stoch_max_bars_since_crossing: 9
  
  # Stochastic Bar Specification
  # Using 15-minute bars for stochastic calculation
  stoch_bar_spec: "15-MINUTE-MID-EXTERNAL"
  
  # ============================================
  # Trade Sizing and Position Management (Fixed)
  # ============================================
  # Keep constant to isolate strategy performance
  
  # Trade Size
  # 100,000 units = 1 standard lot for forex
  trade_size: 100000
  
  # Enforce Position Limit
  # Prevent multiple positions in same direction
  enforce_position_limit: true
  
  # Allow Position Reversal
  # Do not allow flipping from long to short (or vice versa) without closing first
  allow_position_reversal: false

# ============================================
# Configuration Summary
# ============================================
#
# Total Combinations: 5 × 5 × 5 = 125 (120 valid after fast<slow validation)
#
# Parameters Being Optimized:
#   - fast_period: 5 values (10, 20, 30, 40, 50)
#   - slow_period: 5 values (50, 100, 150, 200, 250)
#   - crossover_threshold_pips: 5 values (0.0, 0.5, 1.0, 1.5, 2.0)
#
# Fixed Parameters: 18 parameters at baseline defaults
#
# Expected Runtime:
#   - With 8 workers: ~2-3 hours
#   - Per backtest: ~60 seconds (7-month period)
#   - Total backtest time: 120 × 60s = 7,200s = 120 minutes
#   - Parallelized: 120 min ÷ 8 workers = ~15 minutes
#   - With overhead: ~2-3 hours total
#
# Output Files:
#   - optimization/results/phase2_coarse_grid_results.csv (all 120 results)
#   - optimization/results/phase2_coarse_grid_results_top_10.json (best 10 parameter sets)
#   - optimization/results/phase2_coarse_grid_results_summary.json (statistics)
#   - optimization/checkpoints/phase2_coarse_grid_checkpoint.csv (progress)
#
# Next Steps:
#   1. Review top 10 results in phase2_coarse_grid_results_top_10.json
#   2. Identify best parameter region (e.g., fast=20-30, slow=100-150)
#   3. Create Phase 3 fine grid configuration centered on best region
#   4. Run Phase 3 fine grid search with narrower parameter ranges
