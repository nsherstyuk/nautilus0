# ============================================
# Diagnostic Test Configuration - Limited to 2 Combinations
# ============================================
# This configuration is designed for diagnostic testing with only 2 parameter combinations
# to verify the _get_env_with_fallback() bug fix before running full Phase 3 optimization.
#
# Usage:
#   $env:BACKTEST_SYMBOL = "EUR/USD"
#   $env:BACKTEST_VENUE = "IDEALPRO"
#   $env:BACKTEST_START_DATE = "2025-01-01"
#   $env:BACKTEST_END_DATE = "2025-01-08"  # 1 week only
#   $env:BACKTEST_BAR_SPEC = "15-MINUTE-MID-EXTERNAL"
#   $env:CATALOG_PATH = "data/historical"
#   $env:OUTPUT_DIR = "logs/backtest_results"
#
#   python optimization/grid_search.py \
#     --config optimization/configs/diagnostic_test.yaml \
#     --objective sharpe_ratio \
#     --workers 2 \
#     --output optimization/results/diagnostic_test.csv \
#     --no-resume \
#     --verbose
#
# Expected runtime: 2-3 minutes
# Expected results: 2 completed backtests with non-zero Sharpe ratios

# ============================================
# Optimization Settings
# ============================================
optimization:
  # Objective function to maximize
  objective: sharpe_ratio
  
  # Number of parallel workers (limited for diagnostic)
  workers: 2
  
  # Save checkpoint every N backtests
  checkpoint_interval: 2
  
  # Maximum time per backtest in seconds
  timeout_seconds: 300
  
  # Output file for results
  output_file: optimization/results/diagnostic_test.csv
  
  # Checkpoint file for resuming
  checkpoint_file: optimization/checkpoints/diagnostic_test_checkpoint.csv

# ============================================
# Parameter Ranges for Diagnostic Test (Only 2 Combinations)
# ============================================
# Testing only the first 2 combinations from Phase 3 fine grid
# This verifies the bug fix without running the full 125 combinations
parameters:
  # Fast Moving Average Period - Only 2 values
  fast_period:
    values: [36, 38]
  
  # Slow Moving Average Period - Only 1 value (to get exactly 2 combinations)
  slow_period:
    values: [230]
  
  # Crossover Threshold (pips) - Only 1 value (to get exactly 2 combinations)
  crossover_threshold_pips:
    values: [0.35]

# ============================================
# Fixed Parameters (Same as Phase 3)
# ============================================
fixed:
  # Risk Management Parameters
  stop_loss_pips: 25
  take_profit_pips: 50
  trailing_stop_activation_pips: 20
  trailing_stop_distance_pips: 15
  
  # Crossover Filter Parameters
  pre_crossover_separation_pips: 0.0
  pre_crossover_lookback_bars: 1
  
  # DMI Filter Parameters
  dmi_enabled: true
  dmi_period: 14
  dmi_bar_spec: "2-MINUTE-MID-EXTERNAL"
  
  # Stochastic Filter Parameters
  stoch_enabled: true
  stoch_period_k: 14
  stoch_period_d: 3
  stoch_bullish_threshold: 30
  stoch_bearish_threshold: 70
  stoch_max_bars_since_crossing: 9
  stoch_bar_spec: "15-MINUTE-MID-EXTERNAL"
  
  # Trade Sizing and Position Management
  trade_size: 100000
  enforce_position_limit: true
  allow_position_reversal: false

# ============================================
# Configuration Summary
# ============================================
#
# Total Combinations: 2 × 1 × 1 = 2
#
# Parameters Being Tested:
#   - fast_period: [36, 38] (2 values)
#   - slow_period: [230] (1 value)
#   - crossover_threshold_pips: [0.35] (1 value)
#
# Expected Results:
#   - 2 backtests should complete successfully
#   - Both should have status="completed"
#   - Both should have non-zero Sharpe ratios
#   - Both should have unique output directories
#   - No NameError exceptions should occur
