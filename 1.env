# NautilusTrader Environment Variables Example
# Copy this file to .env and modify the values as needed

# =============================================================================
# BACKTESTING PARAMETERS
# =============================================================================
# # Interactive Brokers (IBKR) Gateway/TWS connection
# Paper trading typically uses port 7497 for TWS or 4002 for IB Gateway
IB_HOST=127.0.0.1
IB_PORT=7497
IB_CLIENT_ID=1
IB_ACCOUNT_ID=DU123456

# Required Variables
BACKTEST_SYMBOL=EUR/USD
BACKTEST_START_DATE=2024-01-01
BACKTEST_END_DATE=2024-03-31

# Data Ingestion Configuration
DATA_SYMBOLS=EUR/USD                         # ← ADD THIS LINE!
DATA_START_DATE=2025-09-01                  # ← ADD THIS LINE!
DATA_END_DATE=2025-10-10  

# Optional Variables with Defaults
BACKTEST_VENUE=IDEALPRO
BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL  # Default: 1-minute bars for MA crossover strategy
BACKTEST_FAST_PERIOD=50
BACKTEST_SLOW_PERIOD=150
BACKTEST_TRADE_SIZE=100000
BACKTEST_STARTING_CAPITAL=100000.0
CATALOG_PATH=data/historical
OUTPUT_DIR=logs/backtest_results
ENFORCE_POSITION_LIMIT=true
ALLOW_POSITION_REVERSAL=false

# Stop Loss and Take Profit Configuration
BACKTEST_STOP_LOSS_PIPS=20
BACKTEST_TAKE_PROFIT_PIPS=150

# Trailing Stop Configuration
# Trailing stop activates when position profit reaches activation threshold,
# then dynamically moves stop loss to lock in profits as price moves favorably.
# Example: With activation=20 and distance=15:
#   - Position opens at 1.1000
#   - Price moves to 1.1020 (+20 pips) → trailing activates
#   - Stop loss moves to 1.1005 (current price - 15 pips)
#   - Price moves to 1.1030 → stop moves to 1.1015
#   - Stop only moves in favorable direction (never widens)
BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=100   # Activate trailing after this many pips in profit
BACKTEST_TRAILING_STOP_DISTANCE_PIPS=15    # Trail stop loss by this many pips behind current price

# ============================================================================
# STRATEGY FILTER CONFIGURATION
# ============================================================================
# Crossover threshold filter: Minimum pip difference required for valid crossover
# Rejects signals when |fast_sma - slow_sma| < threshold
# Reduces false signals during ranging/choppy markets
#
# Recommended values:
#   - 0.0: Disabled (all crossovers trigger signals)
#   - 0.5: Light filtering (removes micro-movements)
#   - 0.7: Moderate filtering (default, good balance)
#   - 1.0: Aggressive filtering (only strong crossovers)
#   - 2.0: Very aggressive (may miss valid signals)
#
# For non-FX instruments, threshold is in price units (e.g., $0.01 for stocks)
STRATEGY_CROSSOVER_THRESHOLD_PIPS=0.3  # Minimum pip difference for valid crossover

# ============================================================================
# STRATEGY FILTER CONFIGURATION - DMI (Directional Movement Index)
# ============================================================================
# DMI filter provides trend confirmation for MA crossover signals using multi-timeframe bars.
# Bullish crossover requires +DI > -DI; bearish crossover requires -DI > +DI.
# Signals with mismatched trend are rejected with reason "dmi_trend_mismatch".
STRATEGY_DMI_ENABLED=false                    # Enable/disable DMI filter (default: true)
STRATEGY_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL  # Bar timeframe for DMI (default: 2-minute)
STRATEGY_DMI_PERIOD=14                       # DMI smoothing period (default: 14)
# Notes:
# - DMI needs 14 bars to initialize; signals before init skip the DMI check
# - For FX, prefer MID price side to match catalog data
# - Use -EXTERNAL for historical catalog bars

# =============================================================================
# LIVE TRADING PARAMETERS
# =============================================================================

# Interactive Brokers Configuration
IBKR_HOST=127.0.0.1
IBKR_PORT=7497
IBKR_CLIENT_ID=1

# Core Trading Parameters (Updated with optimized values from grid search rank 1)
LIVE_SYMBOL=EUR/USD
LIVE_VENUE=IDEALPRO
LIVE_BAR_SPEC=1-MINUTE-MID-EXTERNAL
LIVE_FAST_PERIOD=10
LIVE_SLOW_PERIOD=50
LIVE_TRADE_SIZE=100000
LIVE_ENFORCE_POSITION_LIMIT=true
LIVE_ALLOW_POSITION_REVERSAL=false
LIVE_LOG_DIR=logs/live
LIVE_TRADER_ID=LIVE-TRADER-001

# Risk Management - Stop Loss and Take Profit
LIVE_STOP_LOSS_PIPS=25
LIVE_TAKE_PROFIT_PIPS=50

# Trailing Stop Configuration
LIVE_TRAILING_STOP_ACTIVATION_PIPS=20
LIVE_TRAILING_STOP_DISTANCE_PIPS=15

# Crossover Threshold Filter
LIVE_CROSSOVER_THRESHOLD_PIPS=0.0

# DMI Trend Filter (DISABLED per optimization results)
LIVE_DMI_ENABLED=false
LIVE_DMI_PERIOD=14
LIVE_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL

# Stochastic Momentum Filter (DISABLED per optimization results)
LIVE_STOCH_ENABLED=false
LIVE_STOCH_PERIOD_K=14
LIVE_STOCH_PERIOD_D=3
LIVE_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
LIVE_STOCH_BULLISH_THRESHOLD=30
LIVE_STOCH_BEARISH_THRESHOLD=70
LIVE_STOCH_MAX_BARS_SINCE_CROSSING=9

# ATR Volatility Filter (DISABLED per optimization results)
LIVE_ATR_ENABLED=false
LIVE_ATR_PERIOD=14
LIVE_ATR_MIN_THRESHOLD=0.0003
LIVE_ATR_MAX_THRESHOLD=0.003

# ADX Trend Strength Filter (DISABLED per optimization results)
LIVE_ADX_ENABLED=false
LIVE_ADX_PERIOD=14
LIVE_ADX_MIN_THRESHOLD=20.0

# Time-of-Day Filter (DISABLED per optimization results)
LIVE_TIME_FILTER_ENABLED=false
LIVE_TRADING_HOURS_START=8
LIVE_TRADING_HOURS_END=16
LIVE_MARKET_TIMEZONE=America/New_York
LIVE_EXCLUDED_HOURS=

# Circuit Breaker (ENABLED for safety)
LIVE_CIRCUIT_BREAKER_ENABLED=true
LIVE_MAX_CONSECUTIVE_LOSSES=3
LIVE_COOLDOWN_BARS=10

# Limit Order Configuration
LIVE_USE_LIMIT_ORDERS=true
LIVE_LIMIT_ORDER_TIMEOUT_BARS=1

# =============================================================================
# LIVE TRADING PARAMETER DOCUMENTATION
# =============================================================================
# These parameters are based on grid search optimization results (Rank 1):
# - Objective Value: $1,250.50 (total PnL)
# - Optimization Date Range: 2024-01-01 to 2024-03-31
# - Strategy: Moving Average Crossover with filters DISABLED
# - Risk/Reward: 2:1 (25 pips SL / 50 pips TP)
#
# Key Findings from Optimization:
# 1. Faster MA periods (10/50) outperformed slower periods (20/100)
# 2. No crossover threshold (0.0) performed best
# 3. All filters (DMI, Stochastic, ATR, ADX) were disabled for best results
# 4. Standard risk management (25/50 pips) with trailing stops
#
# IMPORTANT NOTES FOR LIVE TRADING:
# - Start with paper trading account (IB_ACCOUNT_ID should start with DU)
# - Monitor first 24 hours continuously
# - Filters are DISABLED - strategy relies purely on MA crossover
# - Circuit breaker is ENABLED as safety measure (not in optimization)
# - Expected trade frequency: Higher than filtered strategy
# - Expected rejection rate: Low (~0-10% vs 99% in baseline)
#
# VALIDATION STATUS:
# - In-sample performance: $1,250.50 (optimization period)
# - Out-of-sample validation: [PENDING - run before live deployment]
# - Walk-forward validation: [PENDING - recommended]
# - Parameter clustering: [REVIEW grid_search_results_top_10.json]
#
# DEPLOYMENT CHECKLIST:
# [ ] Verify TWS/Gateway is running on port 7497
# [ ] Confirm IB_ACCOUNT_ID is paper trading account (DU prefix)
# [ ] Run out-of-sample backtest with these parameters
# [ ] Review monitoring checklist (see LIVE_TRADING_MONITORING_CHECKLIST.md)
# [ ] Set up daily PnL alerts
# [ ] Define stop conditions (max daily loss, max drawdown)
# [ ] Prepare rollback plan (revert to baseline parameters)
# =============================================================================

# =============================================================================
# FOREX EXAMPLE CONFIGURATION
# =============================================================================

# Example for EUR/USD trading
# BACKTEST_SYMBOL=EURUSD
# BACKTEST_VENUE=IDEALPRO
# BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL
# BACKTEST_STOP_LOSS_PIPS=2     # Stop loss distance in pips (EUR/USD: 25 pips = 0.0025)
# BACKTEST_TAKE_PROFIT_PIPS=5   # Take profit distance in pips (EUR/USD: 50 pips = 0.0050)
# BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=3 # Activate trailing stop after this many pips of profit
# BACKTEST_TRAILING_STOP_DISTANCE_PIPS=1    # Trail stop loss by this many pips behind current price

# =============================================================================
# IBKR HISTORICAL DATA CHUNKING CONFIGURATION
# =============================================================================
# Automatic chunking prevents timeouts when requesting large date ranges.
# IBKR has documented limits (60 requests per 10 minutes) and practical
# timeout thresholds that vary by bar size:
#   - 1-minute bars: ~7 days per request
#   - 15-minute bars: ~60 days per request
#   - Daily bars: ~10 years per request
#
# Chunking splits large date ranges into smaller requests with pacing delays.

# Enable/disable automatic chunking (default: true)
# Set to false to use single requests (only for short date ranges)
IBKR_ENABLE_CHUNKING=true

# Delay between chunk requests in seconds (default: 10)
# Prevents IBKR pacing violations (max 60 requests per 10 minutes)
# Recommended: 10 seconds (safe for all bar sizes)
# Minimum: 1 second (risky, may trigger error 162)
IBKR_REQUEST_DELAY_SECONDS=10

# Overlap between chunks in minutes (default: 0)
# Adds redundancy at chunk boundaries to prevent gaps
# Set to 0 for no overlap (recommended for most use cases)
# Set to 1-5 minutes if you observe missing bars at chunk boundaries
IBKR_CHUNK_OVERLAP_MINUTES=0

# Example: Requesting 30 days of 1-minute bars
# - Without chunking: Single request, likely timeout
# - With chunking: 5 chunks (7+7+7+7+2 days), 10s delay between chunks
# - Total time: ~50 seconds (5 chunks × 10s delay)

# =============================================================================
# STOCK EXAMPLE CONFIGURATION
# =============================================================================

# Example for stock trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=AAPL
# BACKTEST_VENUE=SMART
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For stocks, use percentage-based or tick-based stops instead of pips

# =============================================================================
# CRYPTO EXAMPLE CONFIGURATION
# =============================================================================

# Example for crypto trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=BTC-USD
# BACKTEST_VENUE=COINBASE
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For crypto, use percentage-based or tick-based stops instead of pips
