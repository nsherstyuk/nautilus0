# NautilusTrader Environment Variables Example
# Copy this file to .env and modify the values as needed

# =============================================================================
# BACKTESTING PARAMETERS
# =============================================================================

# Required Variables
BACKTEST_SYMBOL=EUR-USD
BACKTEST_START_DATE=2024-01-01
BACKTEST_END_DATE=2024-12-31

# Optional Variables with Defaults
BACKTEST_VENUE=IDEALPRO
BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL  # Default: 1-minute bars for MA crossover strategy
BACKTEST_FAST_PERIOD=10
BACKTEST_SLOW_PERIOD=20
BACKTEST_TRADE_SIZE=100
BACKTEST_STARTING_CAPITAL=100000.0
CATALOG_PATH=data/historical
OUTPUT_DIR=logs/backtest_results
ENFORCE_POSITION_LIMIT=true
ALLOW_POSITION_REVERSAL=false

# Stop Loss and Take Profit Configuration
BACKTEST_STOP_LOSS_PIPS=25
BACKTEST_TAKE_PROFIT_PIPS=50

# Trailing Stop Configuration
# Trailing stop activates when position profit reaches activation threshold,
# then dynamically moves stop loss to lock in profits as price moves favorably.
# Example: With activation=20 and distance=15:
#   - Position opens at 1.1000
#   - Price moves to 1.1020 (+20 pips) → trailing activates
#   - Stop loss moves to 1.1005 (current price - 15 pips)
#   - Price moves to 1.1030 → stop moves to 1.1015
#   - Stop only moves in favorable direction (never widens)
BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=20   # Activate trailing after this many pips in profit
BACKTEST_TRAILING_STOP_DISTANCE_PIPS=15     # Trail stop loss by this many pips behind current price

# ============================================================================
# STRATEGY FILTER CONFIGURATION
# ============================================================================
# Crossover threshold filter: Minimum pip difference required for valid crossover
# Rejects signals when |fast_sma - slow_sma| < threshold
# Reduces false signals during ranging/choppy markets
#
# Recommended values:
#   - 0.0: Disabled (all crossovers trigger signals)
#   - 0.5: Light filtering (removes micro-movements)
#   - 0.7: Moderate filtering (default, good balance)
#   - 1.0: Aggressive filtering (only strong crossovers)
#   - 2.0: Very aggressive (may miss valid signals)
#
# For non-FX instruments, threshold is in price units (e.g., $0.01 for stocks)
STRATEGY_CROSSOVER_THRESHOLD_PIPS=0.7  # Minimum pip difference for valid crossover

# =============================================================================
# LIVE TRADING PARAMETERS
# =============================================================================

# Interactive Brokers Configuration
IBKR_HOST=127.0.0.1
IBKR_PORT=7497
IBKR_CLIENT_ID=1

# =============================================================================
# FOREX EXAMPLE CONFIGURATION
# =============================================================================

# Example for EUR/USD trading
# BACKTEST_SYMBOL=EUR-USD
# BACKTEST_VENUE=IDEALPRO
# BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL
# BACKTEST_STOP_LOSS_PIPS=25     # Stop loss distance in pips (EUR/USD: 25 pips = 0.0025)
# BACKTEST_TAKE_PROFIT_PIPS=50   # Take profit distance in pips (EUR/USD: 50 pips = 0.0050)
# BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=20  # Activate trailing stop after this many pips of profit
# BACKTEST_TRAILING_STOP_DISTANCE_PIPS=15    # Trail stop loss by this many pips behind current price

# =============================================================================
# IBKR HISTORICAL DATA CHUNKING CONFIGURATION
# =============================================================================
# Automatic chunking prevents timeouts when requesting large date ranges.
# IBKR has documented limits (60 requests per 10 minutes) and practical
# timeout thresholds that vary by bar size:
#   - 1-minute bars: ~7 days per request
#   - 15-minute bars: ~60 days per request
#   - Daily bars: ~10 years per request
#
# Chunking splits large date ranges into smaller requests with pacing delays.

# Enable/disable automatic chunking (default: true)
# Set to false to use single requests (only for short date ranges)
IBKR_ENABLE_CHUNKING=true

# Delay between chunk requests in seconds (default: 10)
# Prevents IBKR pacing violations (max 60 requests per 10 minutes)
# Recommended: 10 seconds (safe for all bar sizes)
# Minimum: 1 second (risky, may trigger error 162)
IBKR_REQUEST_DELAY_SECONDS=10

# Overlap between chunks in minutes (default: 0)
# Adds redundancy at chunk boundaries to prevent gaps
# Set to 0 for no overlap (recommended for most use cases)
# Set to 1-5 minutes if you observe missing bars at chunk boundaries
IBKR_CHUNK_OVERLAP_MINUTES=0

# Example: Requesting 30 days of 1-minute bars
# - Without chunking: Single request, likely timeout
# - With chunking: 5 chunks (7+7+7+7+2 days), 10s delay between chunks
# - Total time: ~50 seconds (5 chunks × 10s delay)

# =============================================================================
# STOCK EXAMPLE CONFIGURATION
# =============================================================================

# Example for stock trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=AAPL
# BACKTEST_VENUE=SMART
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For stocks, use percentage-based or tick-based stops instead of pips

# =============================================================================
# CRYPTO EXAMPLE CONFIGURATION
# =============================================================================

# Example for crypto trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=BTC-USD
# BACKTEST_VENUE=COINBASE
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For crypto, use percentage-based or tick-based stops instead of pips
