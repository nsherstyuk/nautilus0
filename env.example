# NautilusTrader Environment Variables Example
# Copy this file to .env and modify the values as needed

# =============================================================================
# BACKTESTING PARAMETERS
# =============================================================================

# Required Variables
BACKTEST_SYMBOL=EUR-USD
BACKTEST_START_DATE=2024-01-01
BACKTEST_END_DATE=2024-12-31

# Optional Variables with Defaults
BACKTEST_VENUE=IDEALPRO
BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL  # Default: 1-minute bars for MA crossover strategy
BACKTEST_FAST_PERIOD=10
BACKTEST_SLOW_PERIOD=20
BACKTEST_TRADE_SIZE=100
BACKTEST_STARTING_CAPITAL=100000.0
CATALOG_PATH=data/historical
OUTPUT_DIR=logs/backtest_results
ENFORCE_POSITION_LIMIT=true
ALLOW_POSITION_REVERSAL=false

#
# Multi-Timeframe Bar Ingestion for Forex:
# When ingesting forex data, the script automatically downloads multiple timeframes:
#   - 1-minute bars:  Primary timeframe for MA crossover signals (default)
#   - 2-minute bars:  Used by DMI trend filter (see STRATEGY_DMI_BAR_SPEC)
#   - 15-minute bars: Used by Stochastic momentum filter (see STRATEGY_STOCH_BAR_SPEC)
#   - Daily bars:     Used for longer-term analysis and context
#
# All timeframes are downloaded in a single ingestion run. No additional configuration
# is needed - the script handles chunking automatically based on IBKR limits.
#
# Expected download time for 30 days of EUR/USD data:
#   - 1-minute:  ~43,200 bars (5 chunks × 7 days, ~50 seconds)
#   - 2-minute:  ~21,600 bars (1 chunk × 30 days, ~10 seconds)
#   - 15-minute: ~2,880 bars (1 chunk × 30 days, ~5 seconds)
#   - Daily:     ~30 bars (1 chunk, <1 second)
#   Total: ~65 seconds + pacing delays (~40 seconds) = ~105 seconds (~2 minutes)
#
# Storage requirements per 30 days:
#   - 1-minute:  ~15-20 MB
#   - 2-minute:  ~8-10 MB
#   - 15-minute: ~1-2 MB
#   - Daily:     <1 MB
#   Total: ~25-35 MB per symbol per month

# Stop Loss and Take Profit Configuration
BACKTEST_STOP_LOSS_PIPS=25
BACKTEST_TAKE_PROFIT_PIPS=50

# Trailing Stop Configuration
# Trailing stop activates when position profit reaches activation threshold,
# then dynamically moves stop loss to lock in profits as price moves favorably.
# Example: With activation=20 and distance=15:
#   - Position opens at 1.1000
#   - Price moves to 1.1020 (+20 pips) → trailing activates
#   - Stop loss moves to 1.1005 (current price - 15 pips)
#   - Price moves to 1.1030 → stop moves to 1.1015
#   - Stop only moves in favorable direction (never widens)
BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=20   # Activate trailing after this many pips in profit
BACKTEST_TRAILING_STOP_DISTANCE_PIPS=15     # Trail stop loss by this many pips behind current price

# ============================================================================
# STRATEGY FILTER CONFIGURATION
# ============================================================================
# Crossover threshold filter: Minimum pip difference required for valid crossover
# Rejects signals when |fast_sma - slow_sma| < threshold
# Reduces false signals during ranging/choppy markets
#
# Recommended values:
#   - 0.0: Disabled (all crossovers trigger signals)
#   - 0.5: Light filtering (removes micro-movements)
#   - 0.7: Moderate filtering (default, good balance)
#   - 1.0: Aggressive filtering (only strong crossovers)
#   - 2.0: Very aggressive (may miss valid signals)
#
# For non-FX instruments, threshold is in price units (e.g., $0.01 for stocks)
STRATEGY_CROSSOVER_THRESHOLD_PIPS=0.7  # Minimum pip difference for valid crossover

# ============================================================================
# STRATEGY FILTER CONFIGURATION - TREND FILTER (Price vs EMA)
# ============================================================================
# Trend filter checks if bar closing price is above/below a single EMA.
# Only allows signals when price aligns with the trend direction.
#
# Logic:
# - BUY signals: Only allowed when bar close > EMA(period)
# - SELL signals: Only allowed when bar close < EMA(period)
#
# Benefits:
# - Simple and effective trend confirmation
# - Reduces false signals in ranging markets
# - Works on any timeframe (default: 1-minute bars)
# - Acts as a primary trend filter before other indicators
#
# Configuration Parameters:
STRATEGY_TREND_FILTER_ENABLED=false                   # Enable/disable trend filter (default: false)
STRATEGY_TREND_BAR_SPEC=1-MINUTE-MID-EXTERNAL         # Bar timeframe for trend filter (default: 1-minute)
STRATEGY_TREND_EMA_PERIOD=150                         # EMA period for trend (default: 150)
STRATEGY_TREND_EMA_THRESHOLD_PIPS=0.0                 # Minimum distance in pips above/below EMA (default: 0.0)
#
# Threshold Examples:
# - 0.0: No threshold - just requires price > EMA for BUY, price < EMA for SELL
# - 1.0: Requires price to be at least 1 pip above EMA for BUY, 1 pip below for SELL
# - 5.0: Requires price to be at least 5 pips above EMA for BUY, 5 pips below for SELL
# - 10.0: More conservative - requires 10 pips distance from EMA
#
# Important Notes:
# - Trend filter needs warmup period (EMA period bars)
# - Default timeframe is 1-minute (can use any timeframe)
# - Longer EMA periods (150+) provide stronger trend signals
# - Threshold helps ensure meaningful distance from EMA before allowing signals
# - Set STRATEGY_TREND_FILTER_ENABLED=false to disable
# - Ensure trend timeframe bars are available in your data catalog

# ============================================================================
# STRATEGY FILTER CONFIGURATION - RSI (Relative Strength Index)
# ============================================================================
# RSI filter provides momentum confirmation to avoid buying at tops and selling at bottoms.
# For BUY signals: Rejects if RSI > overbought threshold (avoids buying overbought conditions)
# For SELL signals: Rejects if RSI < oversold threshold (avoids selling oversold conditions)
#
# Benefits:
# - Prevents buying at market tops and selling at market bottoms
# - Complements stochastic momentum filter
# - Works on primary timeframe for immediate signal validation
#
# Configuration Parameters:
STRATEGY_RSI_ENABLED=false                    # Enable/disable RSI filter (default: false)
STRATEGY_RSI_PERIOD=14                       # RSI calculation period (default: 14)
STRATEGY_RSI_OVERBOUGHT=70                   # RSI overbought threshold for BUY rejection (default: 70)
STRATEGY_RSI_OVERSOLD=30                     # RSI oversold threshold for SELL rejection (default: 30)
STRATEGY_RSI_DIVERGENCE_LOOKBACK=5           # Lookback period for divergence detection (future feature, default: 5)
#
# Important Notes:
# - RSI needs 14 bars to initialize; signals before init skip the RSI check
# - Overbought > 70 and oversold < 30 are common thresholds
# - More aggressive filtering: Use 75/25, more conservative: Use 80/20
# - Set STRATEGY_RSI_ENABLED=false to disable

# ============================================================================
# STRATEGY FILTER CONFIGURATION - VOLUME CONFIRMATION
# ============================================================================
# Volume filter ensures trades only occur on bars with sufficient volume.
# Requires current bar volume to exceed average volume by a multiplier.
#
# Benefits:
# - Avoids trading on low-volume periods (illiquid markets)
# - Confirms market interest in the price movement
# - Improves signal quality by filtering noise
#
# Configuration Parameters:
STRATEGY_VOLUME_ENABLED=false                # Enable/disable volume filter (default: false)
STRATEGY_VOLUME_AVG_PERIOD=20               # Period for volume average calculation (default: 20)
STRATEGY_VOLUME_MIN_MULTIPLIER=1.2          # Minimum volume multiplier above average (default: 1.2)
#
# Important Notes:
# - Volume filter needs warmup period (avg_period bars)
# - Multiplier of 1.0 = requires above-average volume, 1.5 = 50% above average
# - Adjust multiplier based on instrument liquidity (higher for crypto, lower for FX)
# - Set STRATEGY_VOLUME_ENABLED=false to disable
# - Only works if volume data is available in your bar catalog

# ============================================================================
# STRATEGY FILTER CONFIGURATION - ATR (Average True Range)
# ============================================================================
# ATR filter provides trend strength confirmation using volatility as a proxy.
# Only allows signals when market volatility exceeds minimum threshold.
#
# Benefits:
# - Avoids trading in low-volatility, ranging markets
# - Confirms sufficient market movement for trend development
# - Higher ATR often indicates stronger trends
#
# Configuration Parameters:
STRATEGY_ATR_ENABLED=false                  # Enable/disable ATR filter (default: false)
STRATEGY_ATR_PERIOD=14                      # ATR calculation period (default: 14)
STRATEGY_ATR_MIN_STRENGTH=0.001             # Minimum ATR value required (default: 0.001)
#
# Important Notes:
# - ATR needs 14 bars to initialize; signals before init skip check
# - ATR values depend on instrument price level (higher for indices, lower for FX)
# - For EUR/USD (1.05-1.15 range): 0.001 = 10 pips, 0.002 = 20 pips average range
# - For higher-priced assets: scale ATR threshold accordingly
# - Lower threshold = more signals, higher threshold = fewer but stronger trends
# - Set STRATEGY_ATR_ENABLED=false to disable

# ============================================================================ 
# STRATEGY FILTER CONFIGURATION - DMI (Directional Movement Index)
# ============================================================================
# DMI filter provides trend confirmation for MA crossover signals using multi-timeframe bars.
# Bullish crossover requires +DI > -DI; bearish crossover requires -DI > +DI.
# Signals with mismatched trend are rejected with reason "dmi_trend_mismatch".
STRATEGY_DMI_ENABLED=true                    # Enable/disable DMI filter (default: true)
STRATEGY_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL  # Bar timeframe for DMI (default: 2-minute)
STRATEGY_DMI_PERIOD=14                       # DMI smoothing period (default: 14)
# Notes:
# - DMI needs 14 bars to initialize; signals before init skip the DMI check
# - For FX, prefer MID price side to match catalog data
# - Use -EXTERNAL for historical catalog bars

# ============================================================================
# STRATEGY FILTER CONFIGURATION - STOCHASTIC (Momentum Oscillator)
# ============================================================================
# Stochastic filter provides momentum confirmation for MA crossover signals using 15-minute bars.
# This prevents buying at market tops and selling at market bottoms by checking momentum direction
# and overbought/oversold conditions before allowing trade execution.
#
# Gating Logic:
# - Bullish entries (BUY): %K > %D AND %K > 30 AND %D > 30 (upward momentum, not oversold)
# - Bearish entries (SELL): %K < %D AND %K < 70 AND %D < 70 (downward momentum, not overbought)
#
# Benefits:
# - Prevents buying at tops and selling at bottoms
# - Confirms momentum direction before entry
# - Reduces false signals during ranging markets
# - Works as a final filter after DMI trend confirmation
#
# Stochastic Zones (0-100 scale):
# - Oversold: 0-20 (extreme), 0-30 (moderate) - Avoid buying in these zones
# - Neutral: 30-70 - Normal trading range
# - Overbought: 70-100 (moderate), 80-100 (extreme) - Avoid selling in these zones
#
# Configuration Parameters:
STRATEGY_STOCH_ENABLED=true                    # Enable/disable Stochastic filter (default: true)
STRATEGY_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL # Bar timeframe for Stochastic (default: 15-minute)
STRATEGY_STOCH_PERIOD_K=14                    # %K period - fast line (default: 14)
STRATEGY_STOCH_PERIOD_D=3                     # %D period - slow line smoothing (default: 3)
STRATEGY_STOCH_BULLISH_THRESHOLD=30          # Minimum %K/%D for bullish entries (default: 30)
STRATEGY_STOCH_BEARISH_THRESHOLD=70          # Maximum %K/%D for bearish entries (default: 70)
#
# Important Notes:
# - Stochastic needs 14 bars to initialize (3.5 hours for 15-minute bars)
# - Signals before initialization skip the Stochastic check (allows early trading)
# - Set STRATEGY_STOCH_ENABLED=false to disable the filter entirely
# - Ensure 15-minute bars are downloaded in your data catalog
# - Standard threshold ranges: 20/80 (aggressive), 30/70 (moderate), 40/60 (conservative)
#
# Usage Examples:
# # Disable Stochastic filter
# STRATEGY_STOCH_ENABLED=false
#
# # Use 5-minute bars for faster response (requires 5-minute data)
# STRATEGY_STOCH_BAR_SPEC=5-MINUTE-MID-EXTERNAL
#
# # Aggressive thresholds (wider entry zone)
# STRATEGY_STOCH_BULLISH_THRESHOLD=20
# STRATEGY_STOCH_BEARISH_THRESHOLD=80
#
# # Conservative thresholds (narrower entry zone)
# STRATEGY_STOCH_BULLISH_THRESHOLD=40
# STRATEGY_STOCH_BEARISH_THRESHOLD=60

# ============================================================================
# STRATEGY FILTER CONFIGURATION - TIME FILTER (Trading Hours)
# ============================================================================
# Time filter excludes specific hours of the day (UTC) from trading.
# This helps avoid trading during low-liquidity periods or hours with historically poor performance.
#
# Benefits:
# - Avoids trading during low-liquidity periods (e.g., Asian session for EUR/USD)
# - Excludes hours with historically poor performance
# - Reduces overnight risk exposure
# - Improves overall win rate by filtering out unfavorable trading times
#
# Configuration Parameters:
BACKTEST_TIME_FILTER_ENABLED=false              # Enable/disable time filter (default: false)
BACKTEST_EXCLUDED_HOURS=1,2,12,18,21,23         # Comma-separated list of hours (0-23) to exclude (default: empty)
#
# Recommended excluded hours for EUR/USD (based on backtest analysis):
# - Hours 1-2 UTC: Low liquidity (Asian session)
# - Hour 12 UTC: Low activity period
# - Hours 18, 21, 23 UTC: Historically unprofitable periods
#
# Example configurations:
# # Exclude Asian session low-liquidity hours
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_EXCLUDED_HOURS=1,2,3
#
# # Exclude multiple unprofitable hours
# BACKTEST_TIME_FILTER_ENABLED=true
# BACKTEST_EXCLUDED_HOURS=1,2,12,18,21,23
#
# # Disable time filter (trade all hours)
# BACKTEST_TIME_FILTER_ENABLED=false
#
# Important Notes:
# - Hours are in UTC timezone
# - Hours range from 0-23 (0 = midnight, 23 = 11 PM)
# - Multiple hours can be excluded: "1,2,12" excludes hours 1, 2, and 12
# - Set BACKTEST_TIME_FILTER_ENABLED=false to disable
# - When disabled, excluded_hours has no effect

# =============================================================================
# LIVE TRADING PARAMETERS
# =============================================================================

# Interactive Brokers Configuration
IBKR_HOST=127.0.0.1
IBKR_PORT=7497
IBKR_CLIENT_ID=1

# =============================================================================
# FOREX EXAMPLE CONFIGURATION
# =============================================================================

# Example for EUR/USD trading
# BACKTEST_SYMBOL=EUR-USD
# BACKTEST_VENUE=IDEALPRO
# BACKTEST_BAR_SPEC=1-MINUTE-MID-EXTERNAL
# BACKTEST_STOP_LOSS_PIPS=25     # Stop loss distance in pips (EUR/USD: 25 pips = 0.0025)
# BACKTEST_TAKE_PROFIT_PIPS=50   # Take profit distance in pips (EUR/USD: 50 pips = 0.0050)
# BACKTEST_TRAILING_STOP_ACTIVATION_PIPS=20  # Activate trailing stop after this many pips of profit
# BACKTEST_TRAILING_STOP_DISTANCE_PIPS=15    # Trail stop loss by this many pips behind current price

# =============================================================================
# IBKR HISTORICAL DATA CHUNKING CONFIGURATION
# =============================================================================
# Automatic chunking prevents timeouts when requesting large date ranges.
# IBKR has documented limits (60 requests per 10 minutes) and practical
# timeout thresholds that vary by bar size:
#   - 1-minute bars: ~7 days per request
#   - 15-minute bars: ~60 days per request
#   - Daily bars: ~10 years per request
#
# Chunking splits large date ranges into smaller requests with pacing delays.

# Enable/disable automatic chunking (default: true)
# Set to false to use single requests (only for short date ranges)
IBKR_ENABLE_CHUNKING=true

# Delay between chunk requests in seconds (default: 10)
# Prevents IBKR pacing violations (max 60 requests per 10 minutes)
# Recommended: 10 seconds (safe for all bar sizes)
# Minimum: 1 second (risky, may trigger error 162)
IBKR_REQUEST_DELAY_SECONDS=10

# Overlap between chunks in minutes (default: 0)
# Adds redundancy at chunk boundaries to prevent gaps
# Set to 0 for no overlap (recommended for most use cases)
# Set to 1-5 minutes if you observe missing bars at chunk boundaries
IBKR_CHUNK_OVERLAP_MINUTES=0

# Example: Requesting 30 days of 1-minute bars
# - Without chunking: Single request, likely timeout
# - With chunking: 5 chunks (7+7+7+7+2 days), 10s delay between chunks
# - Total time: ~50 seconds (5 chunks × 10s delay)

# =============================================================================
# STOCK EXAMPLE CONFIGURATION
# =============================================================================

# Example for stock trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=AAPL
# BACKTEST_VENUE=SMART
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For stocks, use percentage-based or tick-based stops instead of pips

# =============================================================================
# CRYPTO EXAMPLE CONFIGURATION
# =============================================================================

# Example for crypto trading (SL/TP pips not applicable)
# BACKTEST_SYMBOL=BTC-USD
# BACKTEST_VENUE=COINBASE
# BACKTEST_BAR_SPEC=1-MINUTE-LAST-EXTERNAL
# Note: For crypto, use percentage-based or tick-based stops instead of pips
