# =============================================================================
# LIVE TRADING ENVIRONMENT CONFIGURATION
# =============================================================================
# This file contains ALL configuration parameters for live trading with
# FULL BACKTEST FEATURE PARITY including:
# - Adaptive stop-loss/take-profit (ATR-based)
# - Market regime detection (trending vs ranging)
# - Weekday-specific hour exclusions (+35.6% validated PnL improvement!)
# - RSI/Volume/ATR filters
# - Complete signal filtering system
#
# CRITICAL: Test in PAPER TRADING mode first! See LIVE_TRADING_FEATURE_PARITY_PLAN.md
# =============================================================================

# =============================================================================
# BASIC TRADING PARAMETERS (REQUIRED)
# =============================================================================
LIVE_SYMBOL=EUR/USD
LIVE_VENUE=IDEALPRO
LIVE_BAR_SPEC=15-MINUTE-MID-EXTERNAL
LIVE_FAST_PERIOD=10
LIVE_SLOW_PERIOD=20
LIVE_TRADE_SIZE=1000
LIVE_TRADER_ID=LIVE-TRADER-001
LIVE_LOG_DIR=logs/live

# =============================================================================
# POSITION MANAGEMENT
# =============================================================================
LIVE_ENFORCE_POSITION_LIMIT=true
LIVE_ALLOW_POSITION_REVERSAL=false

# =============================================================================
# RISK MANAGEMENT - FIXED PIPS (Used when adaptive_stop_mode=fixed)
# =============================================================================
LIVE_STOP_LOSS_PIPS=25
LIVE_TAKE_PROFIT_PIPS=50
LIVE_TRAILING_STOP_ACTIVATION_PIPS=20
LIVE_TRAILING_STOP_DISTANCE_PIPS=15

# =============================================================================
# ADAPTIVE STOPS (NEW - Full Backtest Parity)
# =============================================================================
# Mode: 'fixed' (use pips above), 'atr' (dynamic based on ATR), 'percentile' (volatility-based)
LIVE_ADAPTIVE_STOP_MODE=atr

# ATR-based stop parameters (when mode=atr)
LIVE_ADAPTIVE_ATR_PERIOD=14
LIVE_TP_ATR_MULT=4.25              # Validated optimal: TP = 4.25 × ATR
LIVE_SL_ATR_MULT=1.4               # Validated optimal: SL = 1.4 × ATR
LIVE_TRAIL_ACTIVATION_ATR_MULT=1.0  # Trailing activates at 1.0 × ATR profit
LIVE_TRAIL_DISTANCE_ATR_MULT=0.8    # Trailing follows at 0.8 × ATR distance

# Percentile-based parameters (when mode=percentile)
LIVE_VOLATILITY_WINDOW=200
LIVE_VOLATILITY_SENSITIVITY=0.6

# Safety limit (minimum stop distance regardless of mode)
LIVE_MIN_STOP_DISTANCE_PIPS=5.0

# =============================================================================
# MARKET REGIME DETECTION (NEW - Full Backtest Parity)
# =============================================================================
# Adapts TP/SL/trailing based on trending vs ranging market conditions
LIVE_REGIME_DETECTION_ENABLED=false

# ADX thresholds for regime classification
LIVE_REGIME_ADX_TRENDING_THRESHOLD=25.0  # ADX > 25 = trending market
LIVE_REGIME_ADX_RANGING_THRESHOLD=20.0   # ADX < 20 = ranging market

# TP multipliers (applied to base TP)
LIVE_REGIME_TP_MULTIPLIER_TRENDING=1.5   # 50 pips → 75 pips in trending
LIVE_REGIME_TP_MULTIPLIER_RANGING=0.8    # 50 pips → 40 pips in ranging

# SL multipliers (applied to base SL)
LIVE_REGIME_SL_MULTIPLIER_TRENDING=1.0   # Keep SL same in trending
LIVE_REGIME_SL_MULTIPLIER_RANGING=1.0    # Keep SL same in ranging

# Trailing stop multipliers
LIVE_REGIME_TRAILING_ACTIVATION_MULTIPLIER_TRENDING=0.75  # 20 → 15 pips in trending
LIVE_REGIME_TRAILING_ACTIVATION_MULTIPLIER_RANGING=1.25   # 20 → 25 pips in ranging
LIVE_REGIME_TRAILING_DISTANCE_MULTIPLIER_TRENDING=0.67    # 15 → 10 pips in trending
LIVE_REGIME_TRAILING_DISTANCE_MULTIPLIER_RANGING=1.33     # 15 → 20 pips in ranging

# =============================================================================
# SIGNAL FILTERS
# =============================================================================
# Crossover threshold (minimum MAs separation for valid signal)
LIVE_CROSSOVER_THRESHOLD_PIPS=0.7

# =============================================================================
# DMI INDICATOR (Directional Movement Index)
# =============================================================================
LIVE_DMI_ENABLED=true
LIVE_DMI_PERIOD=14
LIVE_DMI_BAR_SPEC=2-MINUTE-MID-EXTERNAL

# =============================================================================
# STOCHASTIC OSCILLATOR
# =============================================================================
LIVE_STOCH_ENABLED=true
LIVE_STOCH_PERIOD_K=14
LIVE_STOCH_PERIOD_D=3
LIVE_STOCH_BULLISH_THRESHOLD=30      # Must be below this for bullish signal
LIVE_STOCH_BEARISH_THRESHOLD=60      # Must be above this for bearish signal
LIVE_STOCH_BAR_SPEC=15-MINUTE-MID-EXTERNAL
LIVE_STOCH_MAX_BARS_SINCE_CROSSING=18  # Max bars since K/D cross

# =============================================================================
# TIME FILTER WITH WEEKDAY-SPECIFIC EXCLUSIONS (NEW - +35.6% Validated!)
# =============================================================================
LIVE_TIME_FILTER_ENABLED=true

# Mode: 'flat' (same hours all days) or 'weekday' (day-specific exclusions)
LIVE_EXCLUDED_HOURS_MODE=weekday

# Flat mode exclusion (used when mode=flat or as fallback)
LIVE_EXCLUDED_HOURS=0,1,8,10,11,12,13,18,19,23

# Weekday-specific exclusions (VALIDATED +35.6% PnL improvement!)
# These are optimized based on historical EUR/USD performance
LIVE_EXCLUDED_HOURS_MONDAY=0,1,3,4,5,8,10,11,12,13,18,19,23
LIVE_EXCLUDED_HOURS_TUESDAY=0,1,2,4,5,6,7,8,9,10,11,12,13,18,19,23
LIVE_EXCLUDED_HOURS_WEDNESDAY=0,1,8,9,10,11,12,13,14,15,16,17,18,19,21,22,23
LIVE_EXCLUDED_HOURS_THURSDAY=0,1,2,7,8,10,11,12,13,14,18,19,22,23
LIVE_EXCLUDED_HOURS_FRIDAY=0,1,2,3,4,5,8,9,10,11,12,13,14,15,16,17,18,19,23
LIVE_EXCLUDED_HOURS_SATURDAY=
LIVE_EXCLUDED_HOURS_SUNDAY=0,1,8,10,11,12,13,18,19,21,22,23

# =============================================================================
# TREND FILTER (Multi-Timeframe)
# =============================================================================
LIVE_TREND_FILTER_ENABLED=false
LIVE_TREND_BAR_SPEC=1-MINUTE-MID-EXTERNAL
LIVE_TREND_EMA_PERIOD=150
LIVE_TREND_EMA_THRESHOLD_PIPS=0.0  # Minimum distance from EMA to confirm trend

# =============================================================================
# RSI FILTER (NEW - Full Backtest Parity)
# =============================================================================
LIVE_RSI_ENABLED=false
LIVE_RSI_PERIOD=14
LIVE_RSI_OVERBOUGHT=70     # Don't buy if RSI > 70
LIVE_RSI_OVERSOLD=30       # Don't sell if RSI < 30
LIVE_RSI_DIVERGENCE_LOOKBACK=5

# =============================================================================
# VOLUME FILTER (NEW - Full Backtest Parity)
# =============================================================================
LIVE_VOLUME_ENABLED=false
LIVE_VOLUME_AVG_PERIOD=20
LIVE_VOLUME_MIN_MULTIPLIER=1.2  # Require volume > 1.2× average

# =============================================================================
# ATR FILTER (NEW - Full Backtest Parity)
# =============================================================================
# Prevents trading during low volatility periods
LIVE_ATR_ENABLED=false
LIVE_ATR_PERIOD=14
LIVE_ATR_MIN_STRENGTH=0.001  # Minimum ATR value required

# =============================================================================
# ENTRY TIMING (Pullback/Breakout Entry)
# =============================================================================
LIVE_ENTRY_TIMING_ENABLED=false
LIVE_ENTRY_TIMING_BAR_SPEC=2-MINUTE-MID-EXTERNAL
LIVE_ENTRY_TIMING_METHOD=pullback  # Options: pullback, breakout, momentum
LIVE_ENTRY_TIMING_TIMEOUT_BARS=10  # Max bars to wait for entry

# =============================================================================
# INTERACTIVE BROKERS CONNECTION
# =============================================================================
# See config/ibkr_config.py for IBKR-specific settings
# For paper trading: use port 7497
# For live trading: use port 7496
# IBKR_HOST=127.0.0.1
# IBKR_PORT=7497  # Paper trading
# IBKR_CLIENT_ID=1
# IBKR_ACCOUNT_ID=DU1234567  # Paper account starts with DU

# =============================================================================
# TESTING & VALIDATION
# =============================================================================
# CRITICAL: Before live trading with real money:
# 1. Test in paper trading mode (IBKR_PORT=7497) for minimum 1 week
# 2. Verify weekday exclusions work (check logs for rejected signals)
# 3. Confirm adaptive stops calculate reasonable values
# 4. Monitor regime detection switches
# 5. Validate all filters trigger correctly
#
# See LIVE_TRADING_FEATURE_PARITY_PLAN.md for complete testing procedures
# =============================================================================

# =============================================================================
# VALIDATED CONFIGURATION (Copy from .env if using validated backtest settings)
# =============================================================================
# The following configuration achieved $14,846 PnL @ 35.90% win rate in backtest:
# - Adaptive stops: mode=atr, TP=4.25×ATR, SL=1.4×ATR
# - Weekday exclusions: enabled (see optimized hours above)
# - DMI filter: enabled
# - Stochastic filter: enabled (30/60 thresholds)
# - All other filters: disabled (for focused strategy)
# =============================================================================
